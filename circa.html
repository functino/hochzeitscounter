<!doctype html>  
<html lang="en">
	
	<head>
		<meta charset="utf-8">
		<title>H</title>
		<link href='http://fonts.googleapis.com/css?family=Montserrat+Alternates' rel='stylesheet' type='text/css'>				
		<link href='http://fonts.googleapis.com/css?family=Noto+Sans' rel='stylesheet' type='text/css' />
		<meta name="apple-mobile-web-app-capable" content="yes" /> 		
	</head>
	
	<body>
		<div id="content">
			<div id="circle"></div>
			<div id="out"></div>
		</div>
		<script type="text/javascript" src="./jquery.js"> </script>
		<script type="text/javascript" src="./underscore.js"> </script>
		<script type="text/javascript" src="./raphael.js"> </script>
		<script>
			var guessA = parseInt(Math.random()*99);
			var guessB = parseInt(Math.random()*99);
			var current = window.location.hash.substring(1);
			if (isNaN(parseInt(current))) {
				current = parseInt(Math.random()*99);
			}

		    var total = 99;

			var r = Raphael($("#circle")[0], 600, 600),
			    radius = 245,
			    width = 300;
			r.customAttributes.arc = function (value, total, radius) {
			    var alpha = 360 / total * value,
			        a = (90 - alpha) * Math.PI / 180,
			        x = 300 + radius * Math.cos(a),
			        y = 300 - radius * Math.sin(a),
			        path;
			    if (total == value) {
			        path = [["M", width, width - radius], ["A", radius, radius, 0, 1, 1, width-0.01, width - radius]];
			    } else {
			        path = [["M", width, width - radius], ["A", radius, radius, 0, +(alpha > 180), 1, x, y]];
			    }
			    var color = "#58c1f8";
			    if (Math.abs(guessA - value) == Math.abs(guessB - value)) {
			    	color = "#333"
			    } else if(Math.abs(guessA - value) > Math.abs(guessB - value)) {
			    	color = "#98e455";
			    }
			    return {path: path, stroke: color};
			};
			

			var sec = r.path().attr({stroke: "#ffc83a", "stroke-width": 70, arc: [0, total, radius]});

			function updateVal(value, radius, hand, time) {
			  hand.animate({arc: [value, total, radius]}, time, "linear");
			}

			function drawMarks(radius, total) {
			    var out = r.set();
			    for (var value = 0; value < total; value++) {
			        var alpha = 360 / total * value,
			            a = (90 - alpha) * Math.PI / 180,
			            x = 300 + radius * Math.cos(a),
			            y = 300 - radius * Math.sin(a);
				    var color = "#58c1f8";
				    if (Math.abs(guessA - value) == Math.abs(guessB - value)) {
				    	color = "#333"
				    } else if (Math.abs(guessA - value) > Math.abs(guessB - value)) {
				    	color = "#98e455";
				    }			          
				    if (value == 0) {
				    	color = "#ddd"
				    }   
				    var size = 5;
				    var stroke = "none";
				    if (guessA == value || guessB == value) {
				    	size = 27;
				    	stroke = "#000";
				    }
				    var circle = r.circle(x, y, size).attr({fill: color, stroke: stroke, "stroke-width": 2});
				    if (guessA == value || guessB == value) {
				    	circle.toFront();
				    	fontAttrs = {'text-anchor': 'center', "font-size": 32, "font-family": "'Montserrat Alternates'" };
				    	r.text(x , y, "" + value).attr(fontAttrs);
				    	circle.attr({"opacity": 0.8})

				    } else {
				    	circle.toBack();
				    } 
			        out.push(circle);
			    }
			}	



		    var show = function(age) {
    			$("#out").html("")
    			var s = "" + age
    			if (s.length == 1) {
    				s = "0" + s;
    			}
    			for (var j = 0; j < s.length; j++) {
    				$("#out").append("<span class='letter'>" + s[j] + "</span>");
    			}		    	
		    }

		    var delay = 35;
		    var draw = function(number) {
		    	var current = 0;
		    	for (var i = 0; i < number; i++) {
		    		setTimeout(function() {
		    			current++;
		    			show(current);
		    		}, delay * i);
		    	}
		    	updateVal(number, radius, sec, delay * number);
		    }

		    setTimeout(function() {
		    	draw(current);	
		    }, 1000);		    
			drawMarks(radius, total);
			

			sec.click(function(){
				updateVal(0, radius, sec, 0);
				setTimeout(function() {
					draw(parseInt(Math.random()*99));				
				}, 700);
		    	
			});

		</script>		
	    
		<style type="text/css">
			#content {
				margin: 0 auto;
				width: 600px;
				height: 600px;
				/*-webkit-transform: scale(0.5);*/
			}
			#out {
				font-family: 'Noto sans', serif;
				font-weight: bold;
				margin: 0 auto;
				padding-top: 90px;
				color: white;
				font-size: 300px;
				text-align: center;
				color: #333;
			}
			#circle {
				position: absolute;
			}
			.letter {
				display: inline-block;
				width: auto;
				padding: 0px;
			}


		</style>
	</body>
</html>
